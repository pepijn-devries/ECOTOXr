<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Search and retrieve toxicity records from the database — search_ecotox • ECOTOXr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Search and retrieve toxicity records from the database — search_ecotox"><meta name="description" content=" Create (and execute) an SQL search query based on basic search terms and
options. This allows you to search the database, without having to understand SQL."><meta property="og:description" content=" Create (and execute) an SQL search query based on basic search terms and
options. This allows you to search the database, without having to understand SQL."><meta property="og:image" content="https://pepijn-devries.github.io/ECOTOXr/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ECOTOXr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.2.0002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ecotox-schema.html">ECOTOX database schema</a></li>
    <li><a class="dropdown-item" href="../articles/reproducibility.html">Reproducibility</a></li>
    <li><a class="dropdown-item" href="../articles/sanitising-ecotox.html">Sanitising ECOTOX</a></li>
    <li><a class="dropdown-item" href="../articles/searching-ecotox.html">Searching ECOTOX</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pepijn-devries/ECOTOXr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Search and retrieve toxicity records from the database</h1>
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/ECOTOXr/blob/main/R/wrappers.r" class="external-link"><code>R/wrappers.r</code></a></small>
      <div class="d-none name"><code>search_ecotox.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a> Create (and execute) an SQL search query based on basic search terms and
options. This allows you to search the database, without having to understand SQL.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">search_ecotox</span><span class="op">(</span></span>
<span>  <span class="va">search</span>,</span>
<span>  output_fields <span class="op">=</span> <span class="fu"><a href="list_ecotox_fields.html">list_ecotox_fields</a></span><span class="op">(</span><span class="st">"default"</span><span class="op">)</span>,</span>
<span>  group_by_results <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compute <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  as_data_frame <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">search_ecotox_lazy</span><span class="op">(</span></span>
<span>  <span class="va">search</span>,</span>
<span>  output_fields <span class="op">=</span> <span class="fu"><a href="list_ecotox_fields.html">list_ecotox_fields</a></span><span class="op">(</span><span class="st">"default"</span><span class="op">)</span>,</span>
<span>  compute <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">search_query_ecotox</span><span class="op">(</span><span class="va">search</span>, output_fields <span class="op">=</span> <span class="fu"><a href="list_ecotox_fields.html">list_ecotox_fields</a></span><span class="op">(</span><span class="st">"default"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-search">search<a class="anchor" aria-label="anchor" href="#arg-search"></a></dt>
<dd><p>A named <code>list</code> containing the search terms. The names of the elements should refer to
the field (i.e. table header) in which the terms are searched. Use <code><a href="list_ecotox_fields.html">list_ecotox_fields()</a></code> to
obtain a list of available field names.</p>
<p>Each element in that list should contain another list with at least one element named 'terms'. This should
contain a <code>vector</code> of <code>character</code> strings with search terms. Optionally, a second element
named 'method' can be provided which should be set to either '<code>contains</code>' (default, when missing) or
'<code>exact</code>'. In the first case the query will match any record in the indicated field that contains
the search term. In case of '<code>exact</code>' it will only return exact matches. Note that searches are
not case sensitive, but are picky with special (accented) characters. While building the local database
(see <a href="build_ecotox_sqlite.html">build_ecotox_sqlite</a>) such special characters may be treated differently on different
operating systems. For the sake of reproducibility, the user is advised to stick with non-accented
alpha-numeric characters.</p>
<p>Search terms for a specific field (table header) will be combined with 'or'. Meaning that any record that
matches any of the terms are returned. For instance when 'latin_name' 'Daphnia magna' and 'Skeletonema costatum'
are searched, results for both species are returned. Search terms across fields (table headers) are combined with
'and', which will narrow the search. For instance if 'chemical_name' 'benzene' is searched in combination
with 'latin_name' 'Daphnia magna', only tests where Daphnia magna are exposed to benzene are returned.</p>
<p>When this search behaviour described above is not desirable, the user can either adjust the query manually,
or use this function to perform several separate searches and combine the results afterwards.</p>
<p>Beware that some field names are ambiguous and occur in multiple tables (like <code>cas_number' and </code>code').
When searching such fields, the search result may not be as expected.</p></dd>


<dt id="arg-output-fields">output_fields<a class="anchor" aria-label="anchor" href="#arg-output-fields"></a></dt>
<dd><p>A <code>vector</code> of <code>character</code> strings indicating which field names (table headers)
should be included in the output. By default <code>[list_ecotox_fields]("default")</code> is used. Use
<code>[list_ecotox_fields]("all")</code> to list all available fields.</p></dd>


<dt id="arg-group-by-results">group_by_results<a class="anchor" aria-label="anchor" href="#arg-group-by-results"></a></dt>
<dd><p>Ecological test results are generally the most informative element in the ECOTOX
database. Therefore, this search function returns a table with unique results in each row.</p>
<p>However, some tables in the database (such as 'chemical_carriers' and 'dose_responses') have a one to many
relationship with test results. This means that multiple chemical carriers can be linked to a single test result,
similarly, multiple doses can also be linked to a single test result.</p>
<p>By default the search results are grouped by test results. As a result not all doses or chemical carriers may
be displayed in the output. Set the <code>group_by_results</code> parameter to <code>FALSE</code> in order to force SQLite
to output all data (e.g., all carriers). But beware that test results may be duplicated in those cases.</p></dd>


<dt id="arg-compute">compute<a class="anchor" aria-label="anchor" href="#arg-compute"></a></dt>
<dd><p>The ECOTOXr package tries to construct database queries as lazy as possible. Meaning that R
moves as much of the heavy lifting as possible to the database. When your search becomes complicated (e.g., when
including many output fields), you may run into trouble and hit the SQL parser limits. In those cases you can set
this parameter to <code>TRUE</code>. Database queries are then computed in the process of joining tables. This is generally
slower. Alternatively, you could try to include less output fields in order to simplify the query.</p></dd>


<dt id="arg-as-data-frame">as_data_frame<a class="anchor" aria-label="anchor" href="#arg-as-data-frame"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a> <code>logical</code> value indicating whether the result should be
converted into a <code>data.frame</code> (default is <code>TRUE</code>). When set to <code>FALSE</code> the data will be returned as a <code><a href="https://dplyr.tidyverse.org/reference/reexports.html" class="external-link">tbl_df()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to <code><a href="dbConnectEcotox.html">dbConnectEcotox()</a></code> and other functions. You can use this when the database
is not located at the default path (<code><a href="get_path.html">get_ecotox_path()</a></code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>In case of <code>search_query_ecotox</code>, a <code>character</code> string containing an SQL
query is returned. This query is built based on the provided search terms and options.</p>
<p>In case of <code>search_ecotox</code> a <code>data.frame</code> is returned based on the search query built with
<code>search_query_ecotox</code>. The <code>data.frame</code> is unmodified as returned by SQLite, meaning that all
fields are returned as <code>character</code>s (even where the field types are 'date' or 'numeric').
Therefore, retrieved search results may need some post-processing with <code><a href="process_ecotox_numerics.html">process_ecotox_numerics()</a></code>
<code><a href="as_numeric_ecotox.html">as_numeric_ecotox()</a></code></p>
<p>The results are tagged with: a time stamp; the package version used; and the
file path of the SQLite database used in the search (when applicable). These tags are added as attributes
to the output table or query.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The ECOTOX database is stored locally as an SQLite file, which can be queried with SQL. These functions
allow you to automatically generate an SQL query and send it to the database, without having to understand
SQL. The function <code>search_query_ecotox</code> generates and returns the SQL query (which can be edited by
hand if desired). You can also directly call <code>search_ecotox</code>, this will first generate the query,
send it to the database and retrieve the result.</p>
<p>Although the generated query is not optimized for speed, it should be able to process most common searches
within an acceptable time. The time required for retrieving data from a search query depends on the complexity
of the query, the size of the query and the speed of your machine. Most queries should be completed within
seconds (or several minutes at most) on modern machines. If your search require optimisation for speed,
you could try reordering the search fields. You can also edit the query generated with <code>search_query_ecotox</code>
by hand and retrieve it with <code><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">DBI::dbGetQuery()</a></code>.</p>
<p>Note that this package is actively maintained and this function may be revised in future versions.
In order to create reproducible results the user must: always work with an official release from
CRAN and document the package and database version that are used to generate specific results (see also
<code><a href="cite_ecotox.html">cite_ecotox()</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other search-functions:
<code><a href="websearch.html">websearch_ecotox</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Pepijn de Vries</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## let's find the ids of all ecotox tests on species</span></span></span>
<span class="r-in"><span><span class="co">## where Latin names contain either of 2 specific genus names and</span></span></span>
<span class="r-in"><span><span class="co">## where they were exposed to the chemical benzene</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="check_ecotox_availability.html">check_ecotox_availability</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">search</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      latin_name    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        terms          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Skeletonema"</span>, <span class="st">"Daphnia"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        method         <span class="op">=</span> <span class="st">"contains"</span></span></span>
<span class="r-in"><span>      <span class="op">)</span>,</span></span>
<span class="r-in"><span>      chemical_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        terms          <span class="op">=</span> <span class="st">"benzene"</span>,</span></span>
<span class="r-in"><span>        method         <span class="op">=</span> <span class="st">"exact"</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## rows in result each represent a unique test id from the database</span></span></span>
<span class="r-in"><span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">search_ecotox</span><span class="op">(</span><span class="va">search</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">query</span>  <span class="op">&lt;-</span> <span class="fu">search_query_ecotox</span><span class="op">(</span><span class="va">search</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Sorry, you need to use 'download_ecotox_data()' first in order for this to work."</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Sorry, you need to use 'download_ecotox_data()' first in order for this to work."</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pepijn de Vries.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

